<div class="flex flex-row h-screen overflow-hidden bg-gray-100">

    <!-- Left Side: Timer -->
    <div
        class="w-1/3 min-w-[300px] bg-gray-900 text-white flex flex-col items-center justify-center p-8 shadow-lg relative z-20">
        <button mat-icon-button class="absolute top-4 left-4 text-white hover:bg-gray-800" (click)="goBack()">
            <mat-icon>arrow_back</mat-icon>
        </button>

        <div class="text-center w-full">
            <h2 class="text-gray-400 uppercase tracking-widest text-sm font-semibold mb-2">Timer</h2>
            <!-- Use formattedTime() since it is a signal now -->
            <div
                class="text-7xl xl:text-8xl font-mono font-bold tracking-tighter text-blue-400 drop-shadow-lg mb-8 select-none">
                {{ formattedTime() }}
            </div>

            <!-- Timer Controls -->
            <div class="flex justify-center gap-6 mb-8">
                @if (timerRunning()) {
                <button mat-fab color="warn" (click)="pauseTimer()" class="scale-125 transition-transform"
                    matTooltip="Pause">
                    <mat-icon>pause</mat-icon>
                </button>
                } @else {
                <button mat-fab color="primary" (click)="startTimer()" class="scale-125 transition-transform"
                    [disabled]="timerValue() <= 0" matTooltip="Start">
                    <mat-icon>play_arrow</mat-icon>
                </button>
                }

                <button mat-mini-fab color="accent" (click)="stopTimer()" matTooltip="Reset">
                    <mat-icon>stop</mat-icon>
                </button>
            </div>

            <!-- Quick Add Buttons -->
            <div class="grid grid-cols-3 gap-3 max-w-xs mx-auto mb-10">
                <button mat-stroked-button class="text-white border-gray-600 hover:bg-gray-800"
                    (click)="addTime(30)">+30s</button>
                <button mat-stroked-button class="text-white border-gray-600 hover:bg-gray-800"
                    (click)="addTime(60)">+1m</button>
                <button mat-stroked-button class="text-white border-gray-600 hover:bg-gray-800"
                    (click)="addTime(90)">+1.5m</button>
                <button mat-stroked-button class="text-white border-gray-600 hover:bg-gray-800"
                    (click)="addTime(120)">+2m</button>
                <button mat-stroked-button class="text-white border-gray-600 hover:bg-gray-800"
                    (click)="addTime(180)">+3m</button>
                <button mat-stroked-button class="text-white border-gray-600 hover:bg-gray-800"
                    (click)="addTime(300)">+5m</button>
            </div>

            @if (plan()) {
            <div class="p-6 bg-gray-800 rounded-xl border border-gray-700 w-full">
                <h1 class="text-2xl font-bold text-white mb-2 truncate">{{ plan()?.name }}</h1>
                <p class="text-gray-400 text-sm">Ausführung läuft...</p>
            </div>
            }
        </div>
    </div>

    <!-- Right Side: Table -->
    <div class="flex-1 w-2/3 overflow-auto bg-white p-6 relative">
        @if (loading()) {
        <div class="flex h-full items-center justify-center text-gray-500 text-lg">
            Laden...
        </div>
        } @else if (error()) {
        <div class="flex h-full items-center justify-center text-red-500 text-lg font-medium">
            {{ error() }}
            <button mat-stroked-button color="warn" class="ml-4" (click)="goBack()">Zurück</button>
        </div>
        } @else {
        <div class="max-w-5xl mx-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 sticky top-0 bg-white z-10 py-4 border-b">
                Übersicht
            </h2>

            <table mat-table [dataSource]="dataSource" class="w-full">

                <!-- Order Column -->
                <ng-container matColumnDef="order">
                    <th mat-header-cell *matHeaderCellDef class="font-bold text-gray-600 w-16">#</th>
                    <td mat-cell *matCellDef="let element" class="font-medium text-gray-900">{{element.order}}</td>
                </ng-container>

                <!-- Description Column -->
                <ng-container matColumnDef="description">
                    <th mat-header-cell *matHeaderCellDef class="font-bold text-gray-600">Übung</th>
                    <td mat-cell *matCellDef="let element" class="text-gray-800 font-medium text-lg">
                        {{element.training_exercise_description}}
                        @if(element.equipment) {
                        <span class="block text-xs text-gray-500 font-normal mt-1">{{element.equipment}}</span>
                        }
                    </td>
                </ng-container>

                <ng-container matColumnDef="sets_info">
                    <th mat-header-cell *matHeaderCellDef class="font-bold text-gray-600">Wdh.</th>
                    <td mat-cell *matCellDef="let element" class="text-gray-700 text-lg">
                        {{element.reps}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="break_time">
                    <th mat-header-cell *matHeaderCellDef class="font-bold text-gray-600">Pause</th>
                    <td mat-cell *matCellDef="let element">
                        <span
                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            {{element.break_time_seconds}}s
                        </span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="video">
                    <th mat-header-cell *matHeaderCellDef class="w-12"></th>
                    <td mat-cell *matCellDef="let element">
                        @if(element.training_exercise_video_url) {
                        <button mat-icon-button color="primary" (click)="openVideo(element.training_exercise_video_url)"
                            matTooltip="Video ansehen">
                            <mat-icon>play_circle_outline</mat-icon>
                        </button>
                        }
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"
                    class="hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-0 h-16"></tr>
            </table>
        </div>
        }
    </div>
</div>